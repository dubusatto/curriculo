name: Gerar PDF do Currículo

on:
  push:
    branches:
      - main
    paths:
      # Só roda se o arquivo .md mudar
      - 'README.md' 

jobs:
  build-pdf:
    permissions:
      contents: write

    runs-on: ubuntu-latest
    steps:
      # 1. Checkout
      - name: Checkout do Repositório
        uses: actions/checkout@v4

      # 2. Instalar Pandoc e LaTeX
      - name: Instalar Pandoc e dependências LaTeX
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc texlive-latex-base texlive-latex-extra texlive-fonts-recommended texlive-xetex

      # 3. Criar pasta 'build'
      - name: Criar pasta para o PDF
        run: mkdir -p build

      # 4. Converter Markdown para PDF
      - name: Converter Markdown para PDF
        run: |
          pandoc README.md \
            -o build/curriculo.pdf \
            --pdf-engine=xelatex \
            -V geometry:margin=1in

      # 4.5. Verificar o PDF
      - name: Verificar o PDF gerado
        run: |
          echo "--- VERIFICANDO O ARQUIVO PDF ---"
          ls -lh build/
          file build/curriculo.pdf
          echo "-----------------------------------"
          
      # -----------------------------------------------------------------
      # 4.6. PASSO DE DEBUG NOVO: Salvar o PDF como artefato
      - name: Upload PDF as Artifact (para debugging)
        uses: actions/upload-artifact@v4
        with:
          name: curriculo-pdf-artifact
          path: build/curriculo.pdf
      # -----------------------------------------------------------------

      # 5. Fazer o commit do PDF
      - name: Commit do PDF gerado
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: Atualiza currículo em PDF [BOT]"
          file_pattern: "build/curriculo.pdf"
          commit_user_name: "GitHub Actions Bot"
          commit_user_email: "actions@github.com"
          commit_author: "GitHub Actions Bot <actions@github.com>"